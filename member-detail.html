<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Î©§Î≤Ñ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ</title>
    <!-- JQuery import ÌïòÍ∏∞ -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Bitcount+Prop+Double+Ink:wght@100..900&family=Gowun+Dodum&display=swap');

      @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Chiron+GoRound+TC:wght@200..900&family=Gowun+Dodum&family=IBM+Plex+Sans+KR&family=Jua&family=Nanum+Gothic&family=Nanum+Gothic+Coding&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

      * {
        font-family: "Chiron GoRound TC", sans-serif;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f5f5f5;
        min-height: 100vh;
      }

      .layout-fixed {
        width: 1080px;
      }

      /* ÏÉÅÎã®Î∞î Ï†ÑÏ≤¥ ÏòÅÏó≠ */
      .top-nav {
        width: 100%;
        background-color: #eac2d8;
        color: white;
        padding: 10px 0;
      }

      /* ÏïàÏ™Ω Í≥†Ï†ï Î†àÏù¥ÏïÑÏõÉ (Î≥∏Î¨∏Í≥º Ìè≠ ÎßûÏ∂îÍ∏∞) */
      .nav-container {
        width: 1080px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .nav-container > a {
        color: inherit;
        text-decoration: none;
      }

      .team-name {
        font-family: "Bitcount Prop Double Ink", system-ui;
        font-size: 1.25rem;
        font-weight: bold;
      }

      .header {
        background-color: lightsteelblue;
        height: 50px;
      }

      #home {
        font-size: 27px;
      }

      .member-card .card {
        width: 800px; /* Ïπ¥Îìú Í∞ÄÎ°ú */
        height: 500px;
        margin: 30px auto; /* ÌôîÎ©¥ Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ + ÏúÑÏïÑÎûò Ïó¨Î∞± */
      }

      #comment-title {
        margin: 20px 0px 20px 101px;
        font-size: 25px;
      }

      .comment-container {
        width: 1000px;
        align-items: center;
        justify-content: center;

        margin: 30px auto;
      }

      .comment-register {
        display: flex;
        flex-direction: column;
        align-items: center;

        border-radius: 5px;
      }

      .comment-register > input {
        display: block;
        margin: 5px;
      }

      #name-register {
        width: 200px;
        height: 30px;

        margin-left: 5px;
        padding: 10px 0px 10px 7px;

        border: 1px solid lightgray;
        border-radius: 5px;
      }

      #content-register {
        width: 80%;
        height: 120px;

        padding: 5px 0px 5px 10px;

        border: 1px solid lightgray;
        border-radius: 5px;
      }

      #register-btn {
        background-color: #e7b3d0;
        color: white;
        height: 40px;
        width: 85px;

        display: inline;
        margin: 0px 5px 10px 510px;
        padding: 5px 5px 5px 5px;

        border: 1px solid #e9b0cf;
        border-radius: 5px;
      }

      #register-btn:hover{
        background-color: #e9a3c9;
        border: 1px solid #e9a3c9;
      }

      .comment {
        max-width: 800px;
        min-height: 50px; /* ÎÇ¥Ïö©Ïù¥ ÏóÜÏùÑ Îïå ÏµúÏÜå ÎÜíÏù¥ */
        max-height: 150px; /* ÎÑàÎ¨¥ Í∏∏Î©¥ Ïä§ÌÅ¨Î°§ Ï≤òÎ¶¨ Í∞ÄÎä• */
        overflow: auto; /* max-heightÎ•º ÎÑòÏñ¥Í∞ÄÎ©¥ Ïä§ÌÅ¨Î°§ */
        margin-bottom: 10px;
        margin-top: 10px;
        margin-left: 100px;
      }

      .name-wrap {
        display: flex;
        justify-content: space-between;
        align-items: center;

        height: 25px;
        padding: 1px 0px 2px 5px;
        background-color: #eac2d8;
        font-size: medium;
        border-radius: 2px;
      }

      .name {
        height: 25px;
        padding: 1px 0px 2px 5px;
        background-color: #eac2d8;
        font-size: medium;
        border-radius: 3px;
      }

      .content {
        height: 35px;
        font-size: medium;
        margin: 0px;
        padding: 5px 0px 5px 4px;
        border-bottom: 1px solid #ccc;
      }

      #member-img {
        height: 300px;
      }

      .delete-btn {
        background-color: #eac2d8;
        color: white;

        font-size: 12px;
        border: 1px solid #eac2d8;
        border-radius: 4px;
        
        padding: 5px 6px 2px 6px;
      }

      .delete-btn:hover {
        background-color: #e9a3c9;
        border: 1px solid #e9a3c9;
      }

      .mypostingbox {
        width: 1700px;
        margin: 30px auto 0px auto;
        padding: 20px;
        box-shadow: 0px 0px 3px 0px transparent;
        border-radius: 5px;
        background-color: white;
        box-shadow: 5px 5px 5px 5px gray;
      }

      .mybtn {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-end;
      }

      .card {
        width: 1700px;
        margin: 15px auto 5px auto;
        padding: 20px;
        box-shadow: 0px 0px 3px 0px transparent;
        border-radius: 5px;
      }

      .membercard {
        height: 700px;
        background-color: whitesmoke;
        width: 1700px;
        margin: 30px auto 5px auto;
        padding: 20px;
        box-shadow: 5px 5px 5px 5px gray;
        border-radius: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #member-blog {
        text-decoration: none;
        color: black;
      }

      #member-blog:visited {
        color: black;
      }

      .first_box {
        height: 500px;
        width: 500px;
        margin: 90px auto auto 30px;
        padding: 20px;
        box-shadow: 0px 0px 3px 0px transparent;
        border-radius: 5px;
      }

      .second_box {
        height: 500px;
        background-color: whitesmoke;
        width: 700px;
        margin: 90px 200px auto 60px;
        padding: 10px;
        box-shadow: 0px auto 3px 0px transparent;
        border-radius: 5px;
      }

      .back_ground {
        background-color: lightgray;
      }

      .circle_one {
        position: absolute;
        background-color: lightgray;
        border-top-left-radius: 200px;
        width: 200px;
        height: 200px;
        margin: 500px auto auto 1500px;
        opacity: 0.5;
      }

      .circle_two {
        position: absolute;
        background-color: lightgray;
        border-top-left-radius: 300px;
        width: 300px;
        height: 300px;
        margin: 400px auto auto 1400px;
        opacity: 0.4;
      }

      .circle_three {
        position: absolute;
        background-color: lightgray;
        border-top-left-radius: 400px;
        width: 400px;
        height: 400px;
        margin: 300px auto auto 1300px;
        opacity: 0.3;
      }

      .circle_four {
        position: absolute;
        background-color: lightgray;
        border-top-left-radius: 500px;
        width: 500px;
        height: 500px;
        margin: 200px auto auto 1200px;
        opacity: 0.2;
      }

      .circle_five {
        position: absolute;
        background-color: lightgray;
        border-top-left-radius: 600px;
        width: 600px;
        height: 600px;
        margin: 100px auto auto 1100px;
        opacity: 0.1;
      }
    </style>

    <script type="module">
      // Firebase SDK ÎùºÏù¥Î∏åÎü¨Î¶¨ Í∞ÄÏ†∏Ïò§Í∏∞
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
        getDoc,
        doc,
        deleteDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      // Firebase Íµ¨ÏÑ± Ï†ïÎ≥¥ ÏÑ§Ï†ï
      const firebaseConfig = {
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        apiKey: "AIzaSyAaN0oP7dRX_fkIOGG6RZiq-w-XndV6c1k",
        authDomain: "sparta-35436.firebaseapp.com",
        projectId: "sparta-35436",
        storageBucket: "sparta-35436.firebasestorage.app",
        messagingSenderId: "337029385282",
        appId: "1:337029385282:web:bc784eb4944380588e71db",
        measurementId: "G-6WRJLTVW0J",
      };

      // Firebase Ïù∏Ïä§ÌÑ¥Ïä§ Ï¥àÍ∏∞Ìôî
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // urlÏóêÏÑú ÌååÏù¥Ïñ¥Î≤†Ïù¥Ïä§ Î¨∏ÏÑú id Í∞ÄÏ†∏Ïò§Í∏∞
      const urlParams = new URLSearchParams(window.location.search);
      const memberId = urlParams.get("id");

      const docRef = doc(db, "members", memberId);
      const memberSnap = await getDoc(docRef);

      if (memberSnap.exists()) {
        const data = memberSnap.data();

        document.getElementById("member-name").innerText = data["name"];
        document.getElementById("member-mbti").innerText = data["mbti"];
        document.getElementById("member-intro").innerText = data["intro"];
        document.getElementById("member-strength").innerText = data["strength"];
        document.getElementById("member-style").innerText = data["style"];
        document.getElementById("member-image").src = data["image"];
        const link = document.getElementById("member-blog");
        link.setAttribute("href", data["blog"]);
        link.textContent = "Î∏îÎ°úÍ∑∏ Íµ¨Í≤ΩÌïòÍ∏∞"
      } else {
        console.log("Ìï¥Îãπ Î©§Î≤Ñ Î¨∏ÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
      }

      // Îì±Î°ùÌïòÍ∏∞ Î≤ÑÌäº
      $("#register-btn").click(async function () {
        let name = $("#name-register").val();
        let content = $("#content-register").val();

        let doc = {
          name: name,
          content: content,
          memberId: memberId,
        };

        await addDoc(collection(db, "comments"), doc);
        alert("Îì±Î°ù ÏôÑÎ£å!");
        window.location.reload();
      });

      // ÎåìÍ∏Ä Î∂àÎü¨Ïò§Í∏∞
      let docs = await getDocs(collection(db, "comments"));
      docs.forEach((doc) => {
        let row = doc.data();

        if (row.memberId === memberId) {
          // ÏûÖÎ†•Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
          let name = row["name"];
          let content = row["content"];
          let temp_html = ``;

          if (!name) {
            temp_html = `
            <div class="comment" data-id="${doc.id}">
              <div class=name-wrap>
                <span>User</span>
                <button class="delete-btn" type="button">ÏÇ≠Ï†úÌïòÍ∏∞</button>
              </div>
              <p class="content">${content}</p>
            </div>`;
          } else {
            temp_html = `
            <div class="comment" data-id="${doc.id}">
              <div class=name-wrap>
                <span>${name}</span>
                <button class="delete-btn" type="button">ÏÇ≠Ï†úÌïòÍ∏∞</button>
              </div>
              <p class="content">${content}</p>
            </div>`;
          }
          $(".comment-wrap").append(temp_html);
        }
      });

      // ÎåìÍ∏Ä ÏÇ≠Ï†ú Î≤ÑÌäº
      $(document).on("click", ".delete-btn", async function () {
        let commentCard = $(this).closest(".comment");
        let commentId = commentCard.data("id");

        if (!commentId) {
          alert("ÎåìÍ∏Ä IDÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!");
          return;
        }

        await deleteDoc(doc(db, "comments", commentId));
        alert("ÎåìÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
        window.location.reload();
      });
    </script>
  </head>

  <body>
    <!-- ÏÉÅÎã® Î∞î -->
    <header class="top-nav">
      <div class="nav-container">
        <a href="index.html" class="team-name">üç® 2gether</a>
      </div>
    </header>

    <div class="membercard">
      <!-- first_box Ï°∞Ïõê ÏÇ¨ÏßÑ Íµ¨Ïó≠ -->
      <div class="first_box">
        <img id="member-image" src="${image}" class="card-img-top" alt="..." />
      </div>

      <!-- Ï°∞Ïõê Î≥∏Î¨∏ Íµ¨Ïó≠-->
      <div class="second_box" id="member_box">
        <div class="col">
          <div class="mem_card h-100">
            <div class="card-body">
              <h5
                class="card-title"
                id="member-name"
                style="font-size: 50px"
              ></h5>
              <p
                class="card-text_1"
                id="member-mbti"
                style="font-size: 30px"
              ></p>
              <p
                class="card-text_2"
                id="member-intro"
                style="font-size: 29px"
              ></p>
              <p
                class="card-text_3"
                id="member-strength"
                style="font-size: 28px"
              ></p>
              <p
                class="card-text_4"
                id="member-style"
                style="font-size: 27px"
              ></p>
              <p
                class="card-text_5"
                id="member-image"
                style="font-size: 26px"
              ></p>
              <a
                class="card-text_3"
                id="member-blog"
                style="font-size: 28px"
              ></a>
            </div>
          </div>
        </div>
      </div>

      <!--Ï°∞Ïõê ÏÑ§Î™Ö second_box  -->
      <div class="circle_one">
        <img
          src="https://asset.m-gs.kr/prod/64914507/1/550"
          class="card-img-top"
          alt="..."
        />
      </div>
      <div class="circle_two"></div>
      <div class="circle_three"></div>
      <div class="circle_four"></div>
      <div class="circle_five">
        <img
          src="https://www.bing.co.kr/upload/product/2024/05/7ea7552f-a9fd-4e05-9f35-9410b2474e0f.png"
          class="card-img-top"
          alt="..."
        />
      </div>
    </div>

    <div class="comment-container">
      <p id="comment-title">Î∞©Î™ÖÎ°ù</p>

      <div class="comment-register">
        <div>
          <input
            type="text"
            id="name-register"
            maxlength="20"
            placeholder="ÎãâÎÑ§ÏûÑ"
          />
          <button id="register-btn" type="button">Îì±Î°ùÌïòÍ∏∞</button>
        </div>

        <input
          type="text"
          id="content-register"
          maxlength="50"
          placeholder="Î∞©Î™ÖÎ°ùÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî."
        />
      </div>

      <div class="comment-wrap"></div>
    </div>
  </body>
</html>